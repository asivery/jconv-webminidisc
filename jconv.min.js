var unknown=63,unknown2=12539,tables={SJIS:require("./tables/SJIS"),JIS:require("./tables/JIS"),JISEXT:require("./tables/JISEXT"),SJISInverted:require("./tables/SJISInverted"),JISInverted:require("./tables/JISInverted"),JISEXTInverted:require("./tables/JISEXTInverted")},encodings={},Encoding=function(b){this.name=b.name;this.convert=b.convert},jconv=module.exports=function(b,l,f){return jconv.convert(b,l,f)};jconv.defineEncoding=function(b){encodings[b.name]=new Encoding(b)};
jconv.convert=function(b,l,f){if(!f)throw Error("Encoding not recognized.");l=getName(l);f=getName(f);if(l===f)return b;b=ensureBuffer(b);var k=l+"to"+f;if(encodings[k])return encodings[k].convert(b);b=encodings[l+"toUTF8"].convert(b);return encodings["UTF8to"+f].convert(b)};jconv.decode=function(b,l){return jconv.convert(b,l,"UTF8").toString("utf-8")};jconv.encode=function(b,l){return jconv.convert(b,"UTF8",l)};
function getName(b){if(!b)return"UTF8";switch(b.toUpperCase()){case "WINDOWS-31J":case "CP932":case "SJIS":case "SHIFTJIS":case "SHIFT_JIS":return"SJIS";case "EUCJP":case "EUC-JP":return"EUCJP";case "JIS":case "ISO2022JP":case "ISO-2022-JP":case "ISO-2022-JP-1":return"JIS";case "UTF8":case "UTF-8":return"UTF8";default:throw Error("Encoding not recognized.");}}function ensureBuffer(b){b=b||new Buffer(0);return b instanceof Buffer?b:new Buffer(b.toString(),"utf8")}
function toUtf8Buffer(b,l,f){128>b?l[f++]=b:(2048>b?l[f++]=192|b>>>6:(65536>b?l[f++]=224|b>>>12:(2097152>b?l[f++]=240|b>>>18:(67108864>b?l[f++]=248|b>>>24:(l[f++]=252|b/1073741824,l[f++]=128|b>>>24&63),l[f++]=128|b>>>18&63),l[f++]=128|b>>>12&63),l[f++]=128|b>>>6&63),l[f++]=128|b&63);return f}function toUnicodeBuffer(b,l,f){l[f++]=b&255;l[f++]=b>>8;return f}
jconv.defineEncoding({name:"UTF8toSJIS",convert:function(b){for(var l=tables.SJISInverted,f=l[unknown2],k=b.length,g=new Buffer(2*k),d=0,c,a=0;a<k;){c=b[a++];switch(c>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:break;case 12:case 13:c=(c&31)<<6|b[a++]&63;break;case 14:c=(c&15)<<12|(b[a++]&63)<<6|b[a++]&63;break;default:c=(c&7)<<18|(b[a++]&63)<<12|(b[a++]&63)<<6|b[a++]&63}128>c?g[d++]=c:65377<=c&&65439>=c?g[d++]=c-65216:(c=l[c]||f,g[d++]=c>>8,g[d++]=c&255)}return g.slice(0,d)}});
jconv.defineEncoding({name:"UTF8toJIS",convert:function(b){for(var l=tables.JISInverted,f=tables.JISEXTInverted,k=l[unknown2],g=b.length,d=new Buffer(3*g+3),c=0,a,e=0,h=0;h<g;){a=b[h++];switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:break;case 12:case 13:a=(a&31)<<6|b[h++]&63;break;case 14:a=(a&15)<<12|(b[h++]&63)<<6|b[h++]&63;break;default:a=(a&7)<<18|(b[h++]&63)<<12|(b[h++]&63)<<6|b[h++]&63}if(128>a)0!==e&&(e=0,d[c++]=27,d[c++]=40,d[c++]=66),d[c++]=a;else if(65377<=a&&65439>=
a)1!==e&&(e=1,d[c++]=27,d[c++]=40,d[c++]=73),d[c++]=a-65344;else{var m=l[a];m?(2!==e&&(e=2,d[c++]=27,d[c++]=36,d[c++]=66),d[c++]=m>>8,d[c++]=m&255):(a=f[a])?(3!==e&&(e=3,d[c++]=27,d[c++]=36,d[c++]=40,d[c++]=68),d[c++]=a>>8,d[c++]=a&255):(2!==e&&(e=2,d[c++]=27,d[c++]=36,d[c++]=66),d[c++]=k>>8,d[c++]=k&255)}}0!==e&&(d[c++]=27,d[c++]=40,d[c++]=66);return d.slice(0,c)}});
jconv.defineEncoding({name:"UTF8toEUCJP",convert:function(b){for(var l=tables.JISInverted,f=tables.JISEXTInverted,k=l[unknown2],g=b.length,d=new Buffer(2*g),c=0,a,e=0;e<g;){a=b[e++];switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:break;case 12:case 13:a=(a&31)<<6|b[e++]&63;break;case 14:a=(a&15)<<12|(b[e++]&63)<<6|b[e++]&63;break;default:a=(a&7)<<18|(b[e++]&63)<<12|(b[e++]&63)<<6|b[e++]&63}if(128>a)d[c++]=a;else if(65377<=a&&65439>=a)d[c++]=142,d[c++]=a-65472;else{var h=l[a];
h?(d[c++]=(h>>8)-128,d[c++]=(h&255)-128):(a=f[a])?(d[c++]=143,d[c++]=(a>>8)-128,d[c++]=(a&255)-128):(d[c++]=(k>>8)-128,d[c++]=(k&255)-128)}}return d.slice(0,c)}});jconv.defineEncoding({name:"SJIStoUTF8",convert:function(b){for(var l=tables.SJIS,f=toUtf8Buffer,k=b.length,g=new Buffer(3*k),d=0,c,a=0;a<k;)c=b[a++],128>c||(160<=c&&223>=c?c+=65216:(c=(c<<8)+b[a++],c=l[c]||unknown2)),d=f(c,g,d);return g.slice(0,d)}});
jconv.defineEncoding({name:"SJIStoJIS",convert:function(b){for(var l=tables.SJIS,f=tables.JISInverted,k=b.length,g=new Buffer(3*k+3),d=0,c=0,a=0;a<k;){var e=b[a++];if(128>e)0!==c&&(c=0,g[d++]=27,g[d++]=40,g[d++]=66),g[d++]=e;else if(161<=e&&223>=e)1!==c&&(c=1,g[d++]=27,g[d++]=40,g[d++]=73),g[d++]=e-128;else if(238>=e){2!==c&&(c=2,g[d++]=27,g[d++]=36,g[d++]=66);var h=b[a++],e=e<<1;159>h?(e=319>e?e-225:e-97,h=126<h?h-32:h-31):(e=319>e?e-224:e-96,h-=126);g[d++]=e;g[d++]=h}else 250<=e&&(2!==c&&(c=2,g[d++]=
27,g[d++]=36,g[d++]=66),e=(e<<8)+b[a++],e=f[l[e]||unknown2],g[d++]=e>>8,g[d++]=e&255)}0!==c&&(g[d++]=27,g[d++]=40,g[d++]=66);return g.slice(0,d)}});
jconv.defineEncoding({name:"SJIStoEUCJP",convert:function(b){for(var l=tables.SJIS,f=tables.JISInverted,k=b.length,g=new Buffer(2*k),d=0,c=0;c<k;){var a=b[c++];if(128>a)g[d++]=a;else if(161<=a&&223>=a)g[d++]=142,g[d++]=a;else if(238>=a){var e=b[c++],a=a<<1;159>e?(a=319>a?a-97:a-225,e=126<e?e+96:e+97):(a=319>a?a-96:a-224,e+=2);g[d++]=a;g[d++]=e}else 250<=a&&(a=(a<<8)+b[c++],a=f[l[a]||unknown2],g[d++]=(a>>8)-128,g[d++]=(a&255)-128)}return g.slice(0,d)}});
jconv.defineEncoding({name:"JIStoUTF8",convert:function(b){for(var l=tables.JIS,f=tables.JISEXT,k=toUtf8Buffer,g=b.length,d=new Buffer(2*g),c=0,a,e=0,h=0;h<g;){var m=b[h++];if(27===m){var m=b[h++],n=b[h++];switch(m){case 40:66===n?e=0:73===n&&(e=1);break;case 36:64===n||66===n?e=2:40===n&&(e=3,h++)}}else{switch(e){case 0:a=m;break;case 1:a=m+65344;break;case 2:a=(m<<8)+b[h++];a=l[a]||unknown2;break;case 3:a=(m<<8)+b[h++],a=f[a]||unknown2}c=k(a,d,c)}}return d.slice(0,c)}});
jconv.defineEncoding({name:"JIStoSJIS",convert:function(b){for(var l=tables.SJIS,f=tables.SJISInverted,k=f[unknown2],g=b.length,d=new Buffer(2*g),c=0,a=0,e=0;e<g;){var h=b[e++];if(27===h){var m=b[e++],h=b[e++];switch(m){case 40:66===h?a=0:73===h&&(a=1);break;case 36:64===h||66===h?a=2:40===h&&(a=3,e++)}}else switch(a){case 0:d[c++]=h;break;case 1:d[c++]=h+128;break;case 2:m=b[e++];h&1?(h>>=1,h=47>h?h+113:h-79,m=95<m?m+32:m+31):(h>>=1,h=47>=h?h+112:h-80,m+=126);var n=(h&255)<<8|m;60736<=n&&61180>=
n&&(m=f[l[n]]||k,h=m>>8,m&=255);d[c++]=h;d[c++]=m;break;case 3:d[c++]=k>>8,d[c++]=k&255,e++}}return d.slice(0,c)}});
jconv.defineEncoding({name:"JIStoEUCJP",convert:function(b){for(var l=b.length,f=new Buffer(2*l),k=0,g=0,d=0;d<l;){var c=b[d++];if(27===c){var c=b[d++],a=b[d++];switch(c){case 40:66===a?g=0:73===a&&(g=1);break;case 36:64===a||66===a?g=2:40===a&&(g=3,d++)}}else switch(g){case 0:f[k++]=c;break;case 1:f[k++]=142;f[k++]=c+128;break;case 2:f[k++]=c+128;f[k++]=b[d++]+128;break;case 3:f[k++]=143,f[k++]=c+128,f[k++]=b[d++]+128}}return f.slice(0,k)}});
jconv.defineEncoding({name:"EUCJPtoUTF8",convert:function(b){for(var l=tables.JIS,f=tables.JISEXT,k=toUtf8Buffer,g=b.length,d=new Buffer(2*g),c=0,a,e=0;e<g;){a=b[e++];if(!(128>a))if(142===a)a=b[e++]+65216;else if(143===a){a=b[e++]-128;var h=b[e++]-128;a=(a<<8)+h;a=f[a]||unknown2}else h=a-128,a=b[e++]-128,a=(h<<8)+a,a=l[a]||unknown2;c=k(a,d,c)}return d.slice(0,c)}});
jconv.defineEncoding({name:"EUCJPtoSJIS",unknown:tables.SJISInverted[unknown2],convert:function(b){for(var l=tables.SJIS,f=tables.SJISInverted,k=f[unknown2],g=b.length,d=new Buffer(2*g),c=0,a=0;a<g;){var e=b[a++];if(128>e)d[c++]=e;else if(142===e)d[c++]=b[a++];else if(143===e)d[c++]=k>>8,d[c++]=k&255,a+=2;else{var h=b[a++];e&1?(e>>=1,e=111>e?e+49:e+113,h=223<h?h-96:h-97):(e>>=1,e=111>=e?e+48:e+112,h-=2);var m=(e&255)<<8|h;60736<=m&&61180>=m&&(h=f[l[m]]||k,e=h>>8,h&=255);d[c++]=e;d[c++]=h}}return d.slice(0,
c)}});jconv.defineEncoding({name:"EUCJPtoJIS",convert:function(b){for(var l=b.length,f=new Buffer(3*l+3),k=0,g=0,d=0;d<l;){var c=b[d++];128>c?(0!==g&&(g=0,f[k++]=27,f[k++]=40,f[k++]=66),f[k++]=c):(142===c?1!==g&&(g=1,f[k++]=27,f[k++]=40,f[k++]=73):143===c?(3!==g&&(g=3,f[k++]=27,f[k++]=36,f[k++]=40,f[k++]=68),f[k++]=b[d++]-128):(2!==g&&(g=2,f[k++]=27,f[k++]=36,f[k++]=66),f[k++]=c-128),f[k++]=b[d++]-128)}0!==g&&(f[k++]=27,f[k++]=40,f[k++]=66);return f.slice(0,k)}});
