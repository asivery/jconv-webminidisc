var unknown=63,unknown2=12539,tables={SJIS:require("./tables/SJIS"),JIS:require("./tables/JIS"),JISEXT:require("./tables/JISEXT"),SJISInverted:require("./tables/SJISInverted"),JISInverted:require("./tables/JISInverted"),JISEXTInverted:require("./tables/JISEXTInverted")},encodings={},Encoding=function(a){this.name=a.name;this.convert=a.convert},jconv=module.exports=function(a,l,f){return jconv.convert(a,l,f)};jconv.defineEncoding=function(a){encodings[a.name]=new Encoding(a)};
jconv.convert=function(a,l,f){if(!f)throw Error("Encoding not recognized.");l=getName(l);f=getName(f);if(l===f)return a;a=ensureBuffer(a);var k=l+"to"+f;if(encodings[k])return encodings[k].convert(a);a=encodings[l+"toUTF8"].convert(a);return encodings["UTF8to"+f].convert(a)};jconv.decode=function(a,l){return jconv.convert(a,l,"UTF8").toString("utf-8")};jconv.encode=function(a,l){return jconv.convert(a,"UTF8",l)};
function getName(a){if(!a)return"UTF8";switch(a.toUpperCase()){case "WINDOWS-31J":case "CP932":case "SJIS":case "SHIFTJIS":case "SHIFT_JIS":return"SJIS";case "EUCJP":case "EUC-JP":return"EUCJP";case "JIS":case "ISO2022JP":case "ISO-2022-JP":case "ISO-2022-JP-1":return"JIS";case "UTF8":case "UTF-8":return"UTF8";default:throw Error("Encoding not recognized.");}}function ensureBuffer(a){a=a||new Buffer(0);return a instanceof Buffer?a:new Buffer(a.toString(),"utf8")}
function toUtf8Buffer(a,l,f){128>a?l[f++]=a:(2048>a?l[f++]=192|a>>>6:(65536>a?l[f++]=224|a>>>12:(2097152>a?l[f++]=240|a>>>18:(67108864>a?l[f++]=248|a>>>24:(l[f++]=252|a/1073741824,l[f++]=128|a>>>24&63),l[f++]=128|a>>>18&63),l[f++]=128|a>>>12&63),l[f++]=128|a>>>6&63),l[f++]=128|a&63);return f}function toUnicodeBuffer(a,l,f){l[f++]=a&255;l[f++]=a>>8;return f}
jconv.defineEncoding({name:"UTF8toSJIS",convert:function(a){for(var l=tables.SJISInverted,f=l[unknown2],k=a.length,g=new Buffer(2*k),d=0,c,b=0;b<k;){c=a[b++];switch(c>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:break;case 12:case 13:c=(c&31)<<6|a[b++]&63;break;case 14:c=(c&15)<<12|(a[b++]&63)<<6|a[b++]&63;break;default:c=(c&7)<<18|(a[b++]&63)<<12|(a[b++]&63)<<6|a[b++]&63}128>c?g[d++]=c:65377<=c&&65439>=c?g[d++]=c-65216:(c=l[c]||f,g[d++]=c>>8,g[d++]=c&255)}return g.slice(0,d)}});
jconv.defineEncoding({name:"UTF8toJIS",convert:function(a){for(var l=tables.JISInverted,f=tables.JISEXTInverted,k=l[unknown2],g=a.length,d=new Buffer(3*g+3),c=0,b,e=0,h=0;h<g;){b=a[h++];switch(b>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:break;case 12:case 13:b=(b&31)<<6|a[h++]&63;break;case 14:b=(b&15)<<12|(a[h++]&63)<<6|a[h++]&63;break;default:b=(b&7)<<18|(a[h++]&63)<<12|(a[h++]&63)<<6|a[h++]&63}if(128>b)0!==e&&(e=0,d[c++]=27,d[c++]=40,d[c++]=66),d[c++]=b;else if(65377<=b&&65439>=
b)1!==e&&(e=1,d[c++]=27,d[c++]=40,d[c++]=73),d[c++]=b-65344;else{var m=l[b];m?(2!==e&&(e=2,d[c++]=27,d[c++]=36,d[c++]=66),d[c++]=m>>8,d[c++]=m&255):(b=f[b])?(3!==e&&(e=3,d[c++]=27,d[c++]=36,d[c++]=40,d[c++]=68),d[c++]=b>>8,d[c++]=b&255):(2!==e&&(e=2,d[c++]=27,d[c++]=36,d[c++]=66),d[c++]=k>>8,d[c++]=k&255)}}0!==e&&(d[c++]=27,d[c++]=40,d[c++]=66);return d.slice(0,c)}});
jconv.defineEncoding({name:"UTF8toEUCJP",convert:function(a){for(var l=tables.JISInverted,f=tables.JISEXTInverted,k=l[unknown2],g=a.length,d=new Buffer(2*g),c=0,b,e=0;e<g;){b=a[e++];switch(b>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:break;case 12:case 13:b=(b&31)<<6|a[e++]&63;break;case 14:b=(b&15)<<12|(a[e++]&63)<<6|a[e++]&63;break;default:b=(b&7)<<18|(a[e++]&63)<<12|(a[e++]&63)<<6|a[e++]&63}if(128>b)d[c++]=b;else if(65377<=b&&65439>=b)d[c++]=142,d[c++]=b-65472;else{var h=l[b];
h?(d[c++]=(h>>8)-128,d[c++]=(h&255)-128):(b=f[b])?(d[c++]=143,d[c++]=(b>>8)-128,d[c++]=(b&255)-128):(d[c++]=(k>>8)-128,d[c++]=(k&255)-128)}}return d.slice(0,c)}});jconv.defineEncoding({name:"SJIStoUTF8",convert:function(a){for(var l=tables.SJIS,f=toUtf8Buffer,k=a.length,g=new Buffer(3*k),d=0,c,b=0;b<k;)c=a[b++],128>c||(160<=c&&223>=c?c+=65216:(c=(c<<8)+a[b++],c=l[c]||unknown2)),d=f(c,g,d);return g.slice(0,d)}});
jconv.defineEncoding({name:"SJIStoJIS",convert:function(a){for(var l=tables.SJIS,f=tables.JISInverted,k=a.length,g=new Buffer(3*k+3),d=0,c=0,b=0;b<k;){var e=a[b++];if(128>e)0!==c&&(c=0,g[d++]=27,g[d++]=40,g[d++]=66),g[d++]=e;else if(161<=e&&223>=e)1!==c&&(c=1,g[d++]=27,g[d++]=40,g[d++]=73),g[d++]=e-128;else if(238>=e){2!==c&&(c=2,g[d++]=27,g[d++]=36,g[d++]=66);var h=a[b++],e=e<<1;159>h?(e=319>e?e-225:e-97,h=126<h?h-32:h-31):(e=319>e?e-224:e-96,h-=126);g[d++]=e;g[d++]=h}else 250<=e&&(2!==c&&(c=2,g[d++]=
27,g[d++]=36,g[d++]=66),e=(e<<8)+a[b++],e=f[l[e]||unknown2],g[d++]=e>>8,g[d++]=e&255)}0!==c&&(g[d++]=27,g[d++]=40,g[d++]=66);return g.slice(0,d)}});
jconv.defineEncoding({name:"SJIStoEUCJP",convert:function(a){for(var l=tables.SJIS,f=tables.JISInverted,k=a.length,g=new Buffer(2*k),d=0,c=0;c<k;){var b=a[c++];if(128>b)g[d++]=b;else if(161<=b&&223>=b)g[d++]=142,g[d++]=b;else if(238>=b){var e=a[c++],b=b<<1;159>e?(b=319>b?b-97:b-225,e=126<e?e+96:e+97):(b=319>b?b-96:b-224,e+=2);g[d++]=b;g[d++]=e}else 250<=b&&(b=(b<<8)+a[c++],b=f[l[b]||unknown2],g[d++]=(b>>8)-128,g[d++]=(b&255)-128)}return g.slice(0,d)}});
jconv.defineEncoding({name:"JIStoUTF8",convert:function(a){for(var l=tables.JIS,f=tables.JISEXT,k=toUtf8Buffer,g=a.length,d=new Buffer(2*g),c=0,b,e=0,h=0;h<g;){var m=a[h++];if(27===m){var m=a[h++],n=a[h++];switch(m){case 40:66===n||161===a?e=0:73===n&&(e=1);break;case 38:e=2;h+=3;break;case 36:64===n||66===n?e=2:40===n&&(e=3,h++)}}else{switch(e){case 0:b=m;break;case 1:b=m+65344;break;case 2:b=(m<<8)+a[h++];b=l[b]||unknown2;break;case 3:b=(m<<8)+a[h++],b=f[b]||unknown2}c=k(b,d,c)}}return d.slice(0,
c)}});
jconv.defineEncoding({name:"JIStoSJIS",convert:function(a){for(var l=tables.SJIS,f=tables.SJISInverted,k=f[unknown2],g=a.length,d=new Buffer(2*g),c=0,b=0,e=0;e<g;){var h=a[e++];if(27===h){var m=a[e++],h=a[e++];switch(m){case 40:66===h||161===a?b=0:73===h&&(b=1);break;case 38:b=2;e+=3;break;case 36:64===h||66===h?b=2:40===h&&(b=3,e++)}}else switch(b){case 0:d[c++]=h;break;case 1:d[c++]=h+128;break;case 2:m=a[e++];h&1?(h>>=1,h=47>h?h+113:h-79,m=95<m?m+32:m+31):(h>>=1,h=47>=h?h+112:h-80,m+=126);var n=
((h&255)<<8)+m;60736<=n&&61180>=n&&(m=f[l[n]]||k,h=m>>8,m&=255);d[c++]=h;d[c++]=m;break;case 3:d[c++]=k>>8,d[c++]=k&255,e++}}return d.slice(0,c)}});
jconv.defineEncoding({name:"JIStoEUCJP",convert:function(a){for(var l=a.length,f=new Buffer(2*l),k=0,g=0,d=0;d<l;){var c=a[d++];if(27===c){var c=a[d++],b=a[d++];switch(c){case 40:66===b||161===a?g=0:73===b&&(g=1);break;case 38:g=2;d+=3;break;case 36:64===b||66===b?g=2:40===b&&(g=3,d++)}}else switch(g){case 0:f[k++]=c;break;case 1:f[k++]=142;f[k++]=c+128;break;case 2:f[k++]=c+128;f[k++]=a[d++]+128;break;case 3:f[k++]=143,f[k++]=c+128,f[k++]=a[d++]+128}}return f.slice(0,k)}});
jconv.defineEncoding({name:"EUCJPtoUTF8",convert:function(a){for(var l=tables.JIS,f=tables.JISEXT,k=toUtf8Buffer,g=a.length,d=new Buffer(2*g),c=0,b,e=0;e<g;){b=a[e++];if(!(128>b))if(142===b)b=a[e++]+65216;else if(143===b){b=a[e++]-128;var h=a[e++]-128;b=(b<<8)+h;b=f[b]||unknown2}else h=b-128,b=a[e++]-128,b=(h<<8)+b,b=l[b]||unknown2;c=k(b,d,c)}return d.slice(0,c)}});
jconv.defineEncoding({name:"EUCJPtoSJIS",unknown:tables.SJISInverted[unknown2],convert:function(a){for(var l=tables.SJIS,f=tables.SJISInverted,k=f[unknown2],g=a.length,d=new Buffer(2*g),c=0,b=0;b<g;){var e=a[b++];if(128>e)d[c++]=e;else if(142===e)d[c++]=a[b++];else if(143===e)d[c++]=k>>8,d[c++]=k&255,b+=2;else{var h=a[b++];e&1?(e>>=1,e=111>e?e+49:e+113,h=223<h?h-96:h-97):(e>>=1,e=111>=e?e+48:e+112,h-=2);var m=((e&255)<<8)+h;60736<=m&&61180>=m&&(h=f[l[m]]||k,e=h>>8,h&=255);d[c++]=e;d[c++]=h}}return d.slice(0,
c)}});jconv.defineEncoding({name:"EUCJPtoJIS",convert:function(a){for(var l=a.length,f=new Buffer(3*l+3),k=0,g=0,d=0;d<l;){var c=a[d++];128>c?(0!==g&&(g=0,f[k++]=27,f[k++]=40,f[k++]=66),f[k++]=c):(142===c?1!==g&&(g=1,f[k++]=27,f[k++]=40,f[k++]=73):143===c?(3!==g&&(g=3,f[k++]=27,f[k++]=36,f[k++]=40,f[k++]=68),f[k++]=a[d++]-128):(2!==g&&(g=2,f[k++]=27,f[k++]=36,f[k++]=66),f[k++]=c-128),f[k++]=a[d++]-128)}0!==g&&(f[k++]=27,f[k++]=40,f[k++]=66);return f.slice(0,k)}});
