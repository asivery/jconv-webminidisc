var unknown=63,unknown2=12539,tables={SJIS:require("./tables/SJIS"),JIS:require("./tables/JIS"),JISEXT:require("./tables/JISEXT"),SJISInverted:require("./tables/SJISInverted"),JISInverted:require("./tables/JISInverted"),JISEXTInverted:require("./tables/JISEXTInverted")},encodings={},Encoding=function(a){this.name=a.name;this.convert=a.convert},jconv=module.exports=function(a,l,f){return jconv.convert(a,l,f)};jconv.defineEncoding=function(a){encodings[a.name]=new Encoding(a)};
jconv.convert=function(a,l,f){if(!f)throw Error("Encoding not recognized.");l=getName(l);f=getName(f);if(l===f)return a;a=ensureBuffer(a);var k=l+"to"+f;if(encodings[k])return encodings[k].convert(a);a=encodings[l+"toUTF8"].convert(a);return encodings["UTF8to"+f].convert(a)};jconv.decode=function(a,l){return jconv.convert(a,l,"UTF8").toString()};jconv.encode=function(a,l){return jconv.convert(a,"UTF8",l)};
function getName(a){if(!a)return"UTF8";switch(a.toUpperCase()){case "WINDOWS-31J":case "CP932":case "SJIS":case "SHIFTJIS":case "SHIFT_JIS":return"SJIS";case "EUCJP":case "EUC-JP":return"EUCJP";case "JIS":case "ISO2022JP":case "ISO-2022-JP":case "ISO-2022-JP-1":return"JIS";case "UTF8":case "UTF-8":return"UTF8";case "UNICODE":case "UCS2":case "UCS-2":case "UTF16LE":case "UTF-16LE":return"UNICODE";default:throw Error("Encoding not recognized.");}}
function ensureBuffer(a){a=a||new Buffer(0);return a instanceof Buffer?a:new Buffer(a.toString(),"UTF8")}function setUtf8Buffer(a,l,f){128>a?l[f++]=a:(2048>a?l[f++]=192|a>>>6:(65536>a?l[f++]=224|a>>>12:(2097152>a?l[f++]=240|a>>>18:(67108864>a?l[f++]=248|a>>>24:(l[f++]=252|a/1073741824,l[f++]=128|a>>>24&63),l[f++]=128|a>>>18&63),l[f++]=128|a>>>12&63),l[f++]=128|a>>>6&63),l[f++]=128|a&63);return f}function setUnicodeBuffer(a,l,f){l[f++]=a&255;l[f++]=a>>8;return f}
jconv.defineEncoding({name:"UNICODEtoUTF8",convert:function(a){for(var l=setUtf8Buffer,f=a.length,k=new Buffer(3*f),g=0,c,b=0;b<f;)c=a[b++],c=((a[b++]&255)<<8)+c,g=l(c,k,g);return k.slice(0,g)}});
jconv.defineEncoding({name:"UTF8toUNICODE",convert:function(a){for(var l=setUnicodeBuffer,f=a.length,k=new Buffer(2*f),g=0,c,b=0;b<f;){c=a[b++];switch(c>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:break;case 12:case 13:c=(c&31)<<6|a[b++]&63;break;case 14:c=(c&15)<<12|(a[b++]&63)<<6|a[b++]&63;break;default:c=(c&7)<<18|(a[b++]&63)<<12|(a[b++]&63)<<6|a[b++]&63}g=l(c,k,g)}return k.slice(0,g)}});
jconv.defineEncoding({name:"UTF8toSJIS",convert:function(a){for(var l=tables.SJISInverted,f=l[unknown2],k=a.length,g=new Buffer(2*k),c=0,b,d=0;d<k;){b=a[d++];switch(b>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:break;case 12:case 13:b=(b&31)<<6|a[d++]&63;break;case 14:b=(b&15)<<12|(a[d++]&63)<<6|a[d++]&63;break;default:b=(b&7)<<18|(a[d++]&63)<<12|(a[d++]&63)<<6|a[d++]&63}128>b?g[c++]=b:65377<=b&&65439>=b?g[c++]=b-65216:(b=l[b]||f,g[c++]=b>>8,g[c++]=b&255)}return g.slice(0,c)}});
jconv.defineEncoding({name:"UTF8toJIS",convert:function(a){for(var l=tables.JISInverted,f=tables.JISEXTInverted,k=l[unknown2],g=a.length,c=new Buffer(3*g+3),b=0,d,e=0,h=0;h<g;){d=a[h++];switch(d>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:break;case 12:case 13:d=(d&31)<<6|a[h++]&63;break;case 14:d=(d&15)<<12|(a[h++]&63)<<6|a[h++]&63;break;default:d=(d&7)<<18|(a[h++]&63)<<12|(a[h++]&63)<<6|a[h++]&63}if(128>d)0!==e&&(e=0,c[b++]=27,c[b++]=40,c[b++]=66),c[b++]=d;else if(65377<=d&&65439>=
d)1!==e&&(e=1,c[b++]=27,c[b++]=40,c[b++]=73),c[b++]=d-65344;else{var m=l[d];m?(2!==e&&(e=2,c[b++]=27,c[b++]=36,c[b++]=66),c[b++]=m>>8,c[b++]=m&255):(d=f[d])?(3!==e&&(e=3,c[b++]=27,c[b++]=36,c[b++]=40,c[b++]=68),c[b++]=d>>8,c[b++]=d&255):(2!==e&&(e=2,c[b++]=27,c[b++]=36,c[b++]=66),c[b++]=k>>8,c[b++]=k&255)}}0!==e&&(c[b++]=27,c[b++]=40,c[b++]=66);return c.slice(0,b)}});
jconv.defineEncoding({name:"UTF8toEUCJP",convert:function(a){for(var l=tables.JISInverted,f=tables.JISEXTInverted,k=l[unknown2],g=a.length,c=new Buffer(2*g),b=0,d,e=0;e<g;){d=a[e++];switch(d>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:break;case 12:case 13:d=(d&31)<<6|a[e++]&63;break;case 14:d=(d&15)<<12|(a[e++]&63)<<6|a[e++]&63;break;default:d=(d&7)<<18|(a[e++]&63)<<12|(a[e++]&63)<<6|a[e++]&63}if(128>d)c[b++]=d;else if(65377<=d&&65439>=d)c[b++]=142,c[b++]=d-65472;else{var h=l[d];
h?(c[b++]=(h>>8)-128,c[b++]=(h&255)-128):(d=f[d])?(c[b++]=143,c[b++]=(d>>8)-128,c[b++]=(d&255)-128):(c[b++]=(k>>8)-128,c[b++]=(k&255)-128)}}return c.slice(0,b)}});jconv.defineEncoding({name:"SJIStoUTF8",convert:function(a){for(var l=tables.SJIS,f=setUtf8Buffer,k=a.length,g=new Buffer(3*k),c=0,b,d=0;d<k;)b=a[d++],128>b||(160<=b&&223>=b?b+=65216:(b=(b<<8)+a[d++],b=l[b]||unknown2)),c=f(b,g,c);return g.slice(0,c)}});
jconv.defineEncoding({name:"SJIStoJIS",convert:function(a){for(var l=tables.SJIS,f=tables.JISInverted,k=a.length,g=new Buffer(3*k+3),c=0,b=0,d=0;d<k;){var e=a[d++];if(128>e)0!==b&&(b=0,g[c++]=27,g[c++]=40,g[c++]=66),g[c++]=e;else if(161<=e&&223>=e)1!==b&&(b=1,g[c++]=27,g[c++]=40,g[c++]=73),g[c++]=e-128;else if(238>=e){2!==b&&(b=2,g[c++]=27,g[c++]=36,g[c++]=66);var h=a[d++],e=e<<1;159>h?(e=319>e?e-225:e-97,h=126<h?h-32:h-31):(e=319>e?e-224:e-96,h-=126);g[c++]=e;g[c++]=h}else 250<=e&&(2!==b&&(b=2,g[c++]=
27,g[c++]=36,g[c++]=66),e=(e<<8)+a[d++],e=f[l[e]||unknown2],g[c++]=e>>8,g[c++]=e&255)}0!==b&&(g[c++]=27,g[c++]=40,g[c++]=66);return g.slice(0,c)}});
jconv.defineEncoding({name:"SJIStoEUCJP",convert:function(a){for(var l=tables.SJIS,f=tables.JISInverted,k=a.length,g=new Buffer(2*k),c=0,b=0;b<k;){var d=a[b++];if(128>d)g[c++]=d;else if(161<=d&&223>=d)g[c++]=142,g[c++]=d;else if(238>=d){var e=a[b++],d=d<<1;159>e?(d=319>d?d-97:d-225,e=126<e?e+96:e+97):(d=319>d?d-96:d-224,e+=2);g[c++]=d;g[c++]=e}else 250<=d&&(d=(d<<8)+a[b++],d=f[l[d]||unknown2],g[c++]=(d>>8)-128,g[c++]=(d&255)-128)}return g.slice(0,c)}});
jconv.defineEncoding({name:"JIStoUTF8",convert:function(a){for(var l=tables.JIS,f=tables.JISEXT,k=setUtf8Buffer,g=a.length,c=new Buffer(2*g),b=0,d,e=0,h=0;h<g;){var m=a[h++];if(27===m){var m=a[h++],n=a[h++];switch(m){case 40:66===n||161===a?e=0:73===n&&(e=1);break;case 38:e=2;h+=3;break;case 36:64===n||66===n?e=2:40===n&&(e=3,h++)}}else{switch(e){case 0:d=m;break;case 1:d=m+65344;break;case 2:d=(m<<8)+a[h++];d=l[d]||unknown2;break;case 3:d=(m<<8)+a[h++],d=f[d]||unknown2}b=k(d,c,b)}}return c.slice(0,
b)}});
jconv.defineEncoding({name:"JIStoSJIS",convert:function(a){for(var l=tables.SJIS,f=tables.SJISInverted,k=f[unknown2],g=a.length,c=new Buffer(2*g),b=0,d=0,e=0;e<g;){var h=a[e++];if(27===h){var m=a[e++],h=a[e++];switch(m){case 40:66===h||161===a?d=0:73===h&&(d=1);break;case 38:d=2;e+=3;break;case 36:64===h||66===h?d=2:40===h&&(d=3,e++)}}else switch(d){case 0:c[b++]=h;break;case 1:c[b++]=h+128;break;case 2:m=a[e++];h&1?(h>>=1,h=47>h?h+113:h-79,m=95<m?m+32:m+31):(h>>=1,h=47>=h?h+112:h-80,m+=126);var n=
((h&255)<<8)+m;60736<=n&&61180>=n&&(m=f[l[n]]||k,h=m>>8,m&=255);c[b++]=h;c[b++]=m;break;case 3:c[b++]=k>>8,c[b++]=k&255,e++}}return c.slice(0,b)}});
jconv.defineEncoding({name:"JIStoEUCJP",convert:function(a){for(var l=a.length,f=new Buffer(2*l),k=0,g=0,c=0;c<l;){var b=a[c++];if(27===b){var b=a[c++],d=a[c++];switch(b){case 40:66===d||161===a?g=0:73===d&&(g=1);break;case 38:g=2;c+=3;break;case 36:64===d||66===d?g=2:40===d&&(g=3,c++)}}else switch(g){case 0:f[k++]=b;break;case 1:f[k++]=142;f[k++]=b+128;break;case 2:f[k++]=b+128;f[k++]=a[c++]+128;break;case 3:f[k++]=143,f[k++]=b+128,f[k++]=a[c++]+128}}return f.slice(0,k)}});
jconv.defineEncoding({name:"EUCJPtoUTF8",convert:function(a){for(var l=tables.JIS,f=tables.JISEXT,k=setUtf8Buffer,g=a.length,c=new Buffer(2*g),b=0,d,e=0;e<g;){d=a[e++];if(!(128>d))if(142===d)d=a[e++]+65216;else if(143===d){d=a[e++]-128;var h=a[e++]-128;d=(d<<8)+h;d=f[d]||unknown2}else h=d-128,d=a[e++]-128,d=(h<<8)+d,d=l[d]||unknown2;b=k(d,c,b)}return c.slice(0,b)}});
jconv.defineEncoding({name:"EUCJPtoSJIS",unknown:tables.SJISInverted[unknown2],convert:function(a){for(var l=tables.SJIS,f=tables.SJISInverted,k=f[unknown2],g=a.length,c=new Buffer(2*g),b=0,d=0;d<g;){var e=a[d++];if(128>e)c[b++]=e;else if(142===e)c[b++]=a[d++];else if(143===e)c[b++]=k>>8,c[b++]=k&255,d+=2;else{var h=a[d++];e&1?(e>>=1,e=111>e?e+49:e+113,h=223<h?h-96:h-97):(e>>=1,e=111>=e?e+48:e+112,h-=2);var m=((e&255)<<8)+h;60736<=m&&61180>=m&&(h=f[l[m]]||k,e=h>>8,h&=255);c[b++]=e;c[b++]=h}}return c.slice(0,
b)}});jconv.defineEncoding({name:"EUCJPtoJIS",convert:function(a){for(var l=a.length,f=new Buffer(3*l+3),k=0,g=0,c=0;c<l;){var b=a[c++];128>b?(0!==g&&(g=0,f[k++]=27,f[k++]=40,f[k++]=66),f[k++]=b):(142===b?1!==g&&(g=1,f[k++]=27,f[k++]=40,f[k++]=73):143===b?(3!==g&&(g=3,f[k++]=27,f[k++]=36,f[k++]=40,f[k++]=68),f[k++]=a[c++]-128):(2!==g&&(g=2,f[k++]=27,f[k++]=36,f[k++]=66),f[k++]=b-128),f[k++]=a[c++]-128)}0!==g&&(f[k++]=27,f[k++]=40,f[k++]=66);return f.slice(0,k)}});
